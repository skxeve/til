# レベルアップNode.js

中級者を目指す方向けとされているが、他の言語経験があり、多少jsを触ったことがあればいきなりこれを読んでも良い気がする。

よく見るけど本書で深掘りされなかった要素として、Promiseをもう少し詳しく勉強しておいた方が良いかも。

本書で特に知っておくべきと参考になった内容は以下

- イベントキューと、それを処理するイベントループ
  - キューには6種類あり、その中でもnextTickとmicroTaskは特殊
  - microTaskの代表例としてPromiseのコールバックがある
- コールバックの第一引数はエラーオブジェクトまたはnullとする法則がある
- 最後の引数をコールバックとする法則がある
- コールバック地獄の対策テクニック
  - ES2015編
    - 単純な関数分割
    - Promise.thenで連鎖的に処理
    - coモジュールではGeneratorを使って非同期を同期的に扱うアプローチが提供されている
  - ES2017編
    - async/awaitはES標準でcoのような内容を可能にする。
      - async関数はPromiseでラップされた戻り値を返す。awaitを含むことができ、await式は実行を一時停止しPromiseの解決を待つ。
- Promise内でエラーを出すのにrejectを使い、それを捉えるのにcatchを使う。一応thenの第二引数で受け取ることも可能だが、読みにくくなりがち。
- Streamは大きいデータを逐次処理できる仕組み。EventEmitterの文法が基本となる。
  - Async Interactionを使うことで直列的に書きやすくなる。
- AltJS（代替JavaScript言語）
  - TypeScript, CoffeeScript, Haxe, Dart, etc
- Node.jsはFaaSと相性が良い
  - AWS Lambda
  - Azure Functions
  - Google Cloud Functions
  - IBM Cloud Functions
- Node.jsのモジュールには3段階のStabilityがある
  - Stability0 非推奨
  - Stability1 production非推奨
  - Stability2 安定
- `use strict;` はメリットが多いので積極導入すべし
- log4jsによるロギング
- nullは歴史的経緯でobjectと判定される仕様、undefinedはプリミティブ値
- 関数もオブジェクトであり、関数内のthisは関数自身のオブジェクトを指す。ただしアロー関数はthisを持たないため、上の階層のthisを参照できる。


## ノンブロッキングI/Oと非同期I/O

読んでいて気になったのは、ノンブロッキングと非同期の言葉の使い分け。
検索してみるとどうやらこの2個は違う意味。なお同期とブロッキングは同じ意味らしい。

非同期は処理が完了するまでバックグラウンドで待機して完了したらシグナルやコールバックで通知するモデルで、ノンブロッキングは即座にエラーを返却することでブロック状態にさせないモデル。

これを元に本書の内容を見返すと、ノンブロッキングと紹介されたサンプルコードの内容がコールバック処理を使ったものになっているので、おそらく非同期と同じ意味として捉えているように読み取れる。
中級本の著者レベルでも間違えるややこしい概念なのかもしれない。

