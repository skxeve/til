# リーダブルコード

有名な一冊。随分前に読んだことはあったけど、改めて読み直したのでここにも追加。

## 書籍の構成

0部では理解しやすいコードについて。

1部では表面上の改善について、ネーミングと美しさ、コメントに焦点を当てて。

2部ではループを始めとした各種ロジックの単純化、ロジックを小規模に改善する手法について。

3部ではコードの再構成と称して、汎用機能と特化機能、コードに込める意味など、コードを大規模に改善する手法について。

4部では選抜テーマと称して、実際の実装について触れている。（ここは読み飛ばした）

## 読みやすいコードとは何か

1. コードは他の人が最短時間で理解できるように書かなければならない（コードの短さと理解しやすさは必ずしも相関しない）
2. 合理的な範囲で軽量に保たれている
3. 名前に情報が詰め込まれており、名前から役割を勘違いせず理解できる
4. コードを読んでも簡単には読み取れない、しかし有用な情報がコメントに書かれている
5. 制御フローが読みやすい順序で書かれている
6. 変数の定義が最小限の数とスコープに抑えられている
7. 一度に一つのことをする処理の組み合わせで構成されている
8. 下位問題が適度に抽出され、プロジェクトから汎用コードが分離されている

これを逆転させると、読み辛いコードの特徴が浮かび上がる

1. 他の人が理解するのに時間がかかる
2. コードの重量に合理性がない、または少ない
3. 名前から役割を推測できない、または勘違いしやすい
4. コードを読めば簡単にわかる内容がコメント化されている
5. 制御フローが読みにくい順序で書かれている
6. 変数の定義数が無駄に多い、スコープが無駄に広い
7. 一度に複数のことをする処理が分割されず構成されている
8. 下位問題が適切に抽出されず、分離したはずの汎用コードがプロジェクトに依存してしまっている

## ネーミングの重要性

適切な名前をつけることができれば、設計は8割できたようなもの、という有名なフレーズがあるように、読みやすさを考える上で命名は最重要テーマ。

基本は以下

1. 名前に情報を詰め込む
2. 誤解されない名前をつける

コツは以下

1. 明確な単語を選ぶ
  - filterだと曖昧な内容だが、selectにすれば「選択する」excludeにすれば「除外する」となり曖昧さがなくなる
  - getよりfetchやdownloadの方が具体性が増す
2. 汎用的な名前を避ける、または使う時を選ぶ
  - tmp,size,getのような頻出単語であっても、情報がないネーミングになっていることは多い
3. 抽象的な名前よりも具体的な名前を使う
  - ServerCanStartよりCanListenOnPortの方が具体的
4. 接尾辞や接頭辞を使って情報を追加する
  - 接尾辞に単位をつける
5. 名前の長さを決める
  - スコープの大きな変数には長い名前をつける
  - スコープが短ければ短い名前や汎用的な名前でも問題にならない
  - 伝わるなら不要な単語を捨てる（ConvertToString→ToString）
6. 名前のフォーマットを統一する
  - private変数の先頭にアンダースコアをつける


## 変数と読みやすさ

変数を適当に使うとコードは読みにくくなる。

1. 変数が多いと変数を追跡するのが難しくなる
2. 変数のスコープが大きいとスコープを把握する時間が長くなる
3. 変数が頻繁に変更されると現在の値を把握するのが難しくなる

## 細かいテクニック

### 条件式の並び順で意識すること

1. 否定形より肯定形を優先して使う
2. 単純な条件を先に書く
3. 関心を引く条件や目立つ条件を先に書く

### ネストを浅くする

1. 早めにreturnする

### コメントの書き方

大前提として

1. コメントの目的は、書き手の意図を読み手に知らせることである
2. 簡潔で誤解を招かないわかりやすい日本語で書くこと
3. 酷いコードに優れたコメントをつけるより、優れたコードの方が良い

コメントには主に以下のような内容を書いておくと良い。

1. そのロジックを選択した理由（パフォーマンスが良い等）
2. 既にわかっているコードの欠陥
3. 将来コードを見る誰かの助けになるだろう内容
4. ハマりそうな罠の告知
5. 全体像の説明（これを理解するのが最も難しいことが多い）

以下は避ける

1. 代名詞は罠になりやすい（コメントを理解するのに結局コードを読まされる）
2. コードを読めば一瞬でわかるような説明

## Tips

1. プログラミングの時間のほとんどはコードを読む時間！
2. 最も読みやすいコードは、何も書かれていないコードである。
3. 一貫性のあるスタイルは「正しい」スタイルよりも大切だ。
4. 改行の位置やロジックの構成に一貫性を持たせることで読みやすさを上げることができる。
5. 意味をもった単位で段落分けをしたりコメントをつけてグルーピングすることで読みやすさは格段に上昇する。
6. エンジニアリングとは、大きな問題を小さな問題に分割して、それぞれの解決策を組み立てることに他ならない。この原則をコードに当てはめれば、堅牢で読みやすいコードになる。
7. プログラマというのは、実装にかかる労力を過小評価するものでもある。プロトタイプの実装にかかる時間を楽観的に見積もったり、将来的に必要となる保守や文書化などの「負担」時間を忘れたりする。

