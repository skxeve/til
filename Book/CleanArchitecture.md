# Clean Architecture 達人に学ぶソフトウェアの構造と設計

## アーキテクチャとは

> アーキテクチャの形状の目的は、そこに含まれるソフトウェアシステムの開発・デプロイ・運用・保守を容易にすることである。
> それらを容易にするための戦略は、できるだけ長い期間、できるだけ多くの選択肢を残すことである。

### 保守

> 保守は最もコストのかかるものである。
> 保守の主なコストは、洞窟探検とリスクだ。

### あるべき姿

> 優れたアーキテクチャはユースケースを中心にしている。

> アーキテクチャは、システムで使用しているフレームワークではなく、システムそのものについての情報を伝える必要がある。
> 例えば、ヘルスケアシステムを構築しているならば、新しく参加したプログラマがソースリポジトリを見た時に、「ああ、これはヘルスケアシステムだ」と思えるようにしておくべきである。

### バウンダリー

ソフトウェアアーキテクチャにおいて、境界線を引く技芸。

> 境界線は「重要なもの」と「重要ではないもの」の間に引く

### 方針

> 方針の議論には、単一責任の原則（SRP）、オープン・クローズドの原則（OCP）、閉鎖性共通の原則（CCP）、依存関係逆転の法則（DIP）、安定依存の原則（SDP）、安定度・抽象度投下の原則（SAP）が混在している。

## Component

> コンポーネントとは、デプロイの単位のことである。
> システムの一部としてリリースできる、最小限のまとまりを指す。

### コンポーネントの分け方

- 再利用・リリース等価の原則（REP）
> 再利用の単位とリリースの単位は等価になる。
- 閉鎖性共通の原則（CCP）
> 同じ理由、同じタイミングで変更されるクラスをコンポーネントにまとめること。
- 全再利用性の原則（CRP）
> 不要なものには依存しないこと。

この3原則は互いに相反する関係性を含んでいて、三角形で表現できる。
アプリケーションによって優先事項は異なる。バランスの取り方が腕の見せ所。

### 設計

> コンポーネントの構造をトップダウンで設計するのは不可能

### 循環依存について

原則として、循環依存があってはならない。
発生してしまった場合の解消方法は主に以下の2通り。
- 依存関係逆転の原則（DIP）を適用する。
- 新しいコンポーネントを作成し、両方のコンポーネントの依存先とする。

### 「安定度」という概念

- 多くから依存されているコンポーネントは安定度が高い。
依存されているものに対して責務を負っている状態と表現できる。
- 多くに依存しているコンポーネントは、安定度が低い。
依存先に対して従属している、と表現できる。
- 他に対して全く依存していないコンポーネントは、最も安定度が高く、他のコンポーネントの変更に影響を受けることがない。
これを独立していると表現できる。

#### 安定度・抽象度等価の原則（SAP）

- 安定度が高いものに、抽象度の高い実装を集めるべきである。
- 逆に安定度の低いものに、具体性の高い実装を集めるべきである。
- 安定度の高い方向に対して依存すべきである。

## Entity

> エンティティとは、コンピュータシステムの内部にあるオブジェクトであり、最重要ビジネスデータを操作する最重要ビジネスルールをいくつか含んだものである。
> エンティティオブジェクトには、最重要ビジネスデータかそれらのデータへの簡単なアクセス手段が含まれる。
> エンティティのインターフェイスは、そうしたデータを操作する最重要ビジネスルールを実装した関数で構成されている。

> エンティティは、メソッドを持ったオブジェクトでも、データ構造と関数でも構わない。

> エンティティはアプリケーションのオブジェクトになるだろう。

## Usecase

> ユースケースはアプリケーション固有のビジネスルールを記述している。
> ユースケースは、ユーザーインターフェイスについては記述していない。

> ユースケースは、エンティティに入出力するデータの流れを調整し、ユースケースの目標を達成できるように、エンティティに最重要ビジネスルールを使用するように指示を出す。

### エンティティとの関係

> エンティティは自身を制御するユースケースのことを知らない。
> 下位レベルのユースケースは、上位レベルのエンティティのことを知っている。

## クリーンアーキテクチャ

> ソースコードの依存性は、内側（上位レベルの方針）だけに向かっていなければならない。

1層（最上位）：エンティティ
2層：ユースケース
3層：コントローラー、ゲートウェイ、プレゼンター
4層（外部インターフェイス）：デバイス、DB、UI、ウェブ

